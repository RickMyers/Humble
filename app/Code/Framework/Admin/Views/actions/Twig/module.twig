<script type="text/javascript"> 
    if (typeof new_module_app === 'undefined') {
        let new_module_app = Vue.createApp({
            template: Humble.template('admin','module/new'),
            data: () => {
                return {
                    packages: [
                        {
                            "text": "Please select the containing package",
                            "value": ""
                        },
                        {% for package in packages.listSubdirectories('Code/') %}{              
                            text:   "{{ package }}",
                            value:  "{{ package }}"
                        },   
                        {% endfor %}
                    ]
                }
            },
            mounted: () => {
               new EasyEdits('edits/admin/newmodule','new-module');
            },
            created: () => {
            },
            updated: () => {
            },
            destroyed: () => {
            },
            methods: {
                createController: async () => {
                    if (Edits['new-module'].validate()) {
                        const form     = document.querySelector('#new_module_form');
                        const response = await fetch('/admin/controller/create', {
                            method: 'POST',
                            body: new FormData(form)
                        });
                        let text       = await response.text();
                        alert(text);
                    }   
                }
            }
        });
        var win = Desktop.window.list['{{ window_id }}'];
        const component_app = new_module_app.mount('#'+win.content.id);
        win.close(((app) => {
            return function () {
                app.unmount();
            };
        })(new_module_app));
    }    

</script>
