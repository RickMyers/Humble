<script type="text/javascript"> 
    //This is for handling "multiplicity", as in multiple explorer apps open at one time
    Humble.admin['explorer'] = (!Humble.admin['explorer']) ? {} : Humble.admin['explorer'];
    Humble.admin['explorer']['{{ window_id }}'] = Vue.createApp({
        template: Humble.template('admin','explorer/app'),
        app: "#explorer_file_list",
        data() {
                return {
                    window_id: "{{ window_id }}",
                    files: [
                        
                    ]
                }
            },
        mounted() {
           //new EasyEdits('/edits/admin/explorer','explorer');
           this.listFiles('/');
        },
        methods: {
            listFiles(dir) {
                var me = this;
                dir = (!dir) ? '/' : dir;
                console.log(dir);
                if (typeof dir === "string" && (dir!=='/')) {
                    let cwd = $('#explorer_path').val();
                    cwd += (cwd==='/') ? dir : "/"+dir;
                    console.log(cwd);
                } else {
                    cwd='/';
                }
                $('#explorer_path').val(cwd);                
                (new EasyAjax('/admin/explorer/filelist')).addForm('explorer_path_form').then((response) => {
                    me.files = JSON.parse(response);
                //    Desktop.window.list[me.window_id].resize();
                }).post();
            },
            upDirectory() {
                let cwd = $('#explorer_path').val();
                console.log(cwd);
                if (cwd!=='/') {
                    let dir = cwd.split('/');
                    if (dir.length>1) {
                        dir.pop();
                    }
                    cwd = dir.join('/');
                }
                $('#explorer_path').val(cwd);
                this.listFiles();
            },
            expandDirectory(directory) {
                this.listFiles(directory);
            }
        }
    });
    var win = Desktop.window.list['{{ window_id }}'];
    Humble.admin['explorer']['{{ window_id }}'].mount('#'+win.content.id);
    win.resize(() => {
        $('#explorer_file_list').height(win.content.height() - $E('explorer_path_area').offsetHeight - $E('explorer_footer').offsetHeight - 2);
    });
    win.close(((app) => {
        return function () {
            app.unmount();
        };
    })(Humble.admin['explorer']['{{ window_id }}']));
    

</script>